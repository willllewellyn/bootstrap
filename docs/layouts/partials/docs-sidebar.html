<form class="bd-search d-flex align-items-center">
  <input type="search" class="form-control" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
  <button class="btn btn-link bd-search-docs-toggle d-md-none p-0 ml-3" type="button" data-toggle="collapse" data-target="#bd-docs-nav" aria-controls="bd-docs-nav" aria-expanded="false" aria-label="Toggle docs navigation">
    {{ partial "icons/menu.svg" (dict "class" "" "width" "30" "height" "30") }}
  </button>
</form>

<nav class="collapse bd-links" id="bd-docs-nav">
  <!-- I need to fix page_slug; split returns an empty array element as the last item -->
  {{ $.Scratch.Set "page_slug" (last 1 (split .Permalink "/")) }}

  {{ range $i, $group := .Site.Data.nav }}
  {{ $.Scratch.Set "link" ($group.pages | first ) }}
  {{ $.Scratch.Set "link_slug" (($.Scratch.Get "link").title | urlize) }}
  {{ $.Scratch.Set "group_slug" ($group.title | urlize) }}
  {{ $.Scratch.Set "active" "" }}

  {{ if (eq .Params.group ($.Scratch.Get "group_slug")) }}
    {{ $.Scratch.Set "active" "active" }}
  {{ end }}

  <div class="bd-toc-item{{ with $.Scratch.Get "active" }} {{ . }}{{ end }}">
      <a class="bd-toc-link" href="{{ .Site.BaseURL }}/docs/{{ .Site.Params.docs_version }}/{{ $.Scratch.Get "group_slug" }}/{{ $.Scratch.Get "link_slug" }}{{ if not (($.Scratch.Get "link_slug") "") }}/{{ end }}">
        {{ $group.title }}
      </a>

      <ul class="nav bd-sidenav">
        {{ range $j, $doc := $group.pages }}
          {{ $.Scratch.Set "doc_slug" ($doc.title | urlize) }}
          {{ $.Scratch.Set "active" "" }}

          {{ if (and (eq .Params.group ($.Scratch.Get "group_slug")) (eq ($.Scratch.Get "page_slug") ($.Scratch.Get "doc_slug"))) }}
            {{ $.Scratch.Set "active" "active bd-sidenav-active" }}
          {{ end }}

          <li{{ with $.Scratch.Get "active" }} class="{{ . }}"{{ end }}>
            <a href="{{ .Site.BaseURL }}/docs/{{ .Site.Params.docs_version }}/{{ $.Scratch.Get "group_slug" }}/{{ $.Scratch.Get "doc_slug" }}/">
              {{ $doc.title }}
            </a>
          </li>
        {{ end }}
      </ul>
    </div>
  {{ end }}
</nav>
